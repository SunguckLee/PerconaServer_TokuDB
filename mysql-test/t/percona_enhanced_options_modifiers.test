-- source include/have_innodb.inc
#
# first, ensure that we _can_ set various options without limitation
#
SET @TEMP=@@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=@TEMP;
SET @TEMP=@@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=@TEMP;

SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

SELECT @@GLOBAL.AUTOCOMMIT;

SELECT @@LOCAL.AUTOCOMMIT;

SET @@GLOBAL.AUTOCOMMIT= TRUE;

SET @@LOCAL.AUTOCOMMIT= TRUE;

SET @TEMP=@@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=100;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=300;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=160;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=@TEMP;

SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=32;

#
# restart the server with some options modifiers and limits
#
--exec echo "wait" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--shutdown_server 10
--source include/wait_until_disconnected.inc
--enable_reconnect
--exec echo "restart:--auto-increment-increment=7 --minimum-auto-increment-increment=5 --maximum-auto-increment-increment=10 --readonly-auto-increment-offset=TRUE --hidden-autocommit=TRUE --innodb-io-capacity=150 --minimum-innodb-io-capacity=150 --maximum-innodb-io-capacity=200 --readonly-innodb-spin-wait-delay=TRUE --hidden-innodb-read-ahead-threshold=TRUE" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--source include/wait_until_connected_again.inc

#
# test the limits set by the above options modifiers
#
SET @TEMP=@@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@GLOBAL.AUTO_INCREMENT_INCREMENT;

SET @@GLOBAL.AUTO_INCREMENT_INCREMENT=@TEMP;
SET @TEMP=@@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=1;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=2;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=15;
SELECT @@LOCAL.AUTO_INCREMENT_INCREMENT;

SET @@LOCAL.AUTO_INCREMENT_INCREMENT=@TEMP;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@GLOBAL.AUTOCOMMIT;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@LOCAL.AUTOCOMMIT;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.AUTOCOMMIT= TRUE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@LOCAL.AUTOCOMMIT= TRUE;


SET @TEMP=@@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=100;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=300;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=160;
SELECT @@GLOBAL.INNODB_IO_CAPACITY;

SET @@GLOBAL.INNODB_IO_CAPACITY=@TEMP;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=32;

#
# Now test allowed modifier combinations
#
--exec echo "wait" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--shutdown_server 10
--source include/wait_until_disconnected.inc
--enable_reconnect
--exec echo "restart:--readonly-loose-auto-increment-offset=TRUE --hidden-loose-autocommit=TRUE --readonly-loose-innodb-spin-wait-delay=TRUE --hidden-loose-innodb-read-ahead-threshold=TRUE" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--source include/wait_until_connected_again.inc

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.AUTO_INCREMENT_OFFSET=5;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@LOCAL.AUTO_INCREMENT_OFFSET=5;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@GLOBAL.AUTOCOMMIT;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SELECT @@LOCAL.AUTOCOMMIT;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.AUTOCOMMIT= TRUE;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@LOCAL.AUTOCOMMIT= TRUE;

--error ER_INCORRECT_GLOBAL_LOCAL_VAR
SET @@GLOBAL.INNODB_SPIN_WAIT_DELAY=10;

--error ER_UNKNOWN_SYSTEM_VARIABLE
SET @@GLOBAL.INNODB_READ_AHEAD_THRESHOLD=72;
